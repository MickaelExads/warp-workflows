---
name: "Create multiple couchbase "
command: "# Create containers\nfor i in $(seq 1 3); do\n  # macOS arm64 will have this x86 emulated by Rosetta.\n  # Use version \"couchbase:community-7.1.1\" to have a native version running on arm64.\n  docker run -d --name couchbase${i} --network vagrocker_exads_net --ip 10.42.0.1${i} --platform linux/amd64 couchbase:community-6.6.0\ndone\n\n# Wait a bit to allow node startup\nsleep 10\n\n# Initialize couchbase cluster\ndocker exec -it couchbase1 /bin/bash -c \"\n  couchbase-cli cluster-init --cluster=10.42.0.11 --cluster-username=admin --cluster-password=exadsexads --cluster-ramsize=2048 --services=data,data,data;\n  couchbase-cli bucket-create --cluster=10.42.0.11 --bucket=exads --bucket-type=ephemeral --bucket-ramsize=1024 --bucket-replica=0 --bucket-eviction-policy=nruEviction --username=admin --password=exadsexads;\n  couchbase-cli bucket-create --cluster=10.42.0.11 --bucket=exads-xdcr --bucket-type=ephemeral --bucket-ramsize=1024 --bucket-replica=0 --bucket-eviction-policy=nruEviction --username=admin --password=exadsexads;\n  couchbase-cli user-manage --cluster=10.42.0.11 --set --rbac-username=exads --rbac-password=exadsexads --roles='bucket_full_access[*],ro_admin' --auth-domain=local --username=admin --password=exadsexads;\n  couchbase-cli user-manage --cluster=10.42.0.11 --set --rbac-username=xdcr --rbac-password=exadsexads --auth-domain=local --username=admin --password=exadsexads;\n\"\n\n# Join other nodes to cluster\nfor i in $(seq 2 3); do\n  docker exec -it couchbase2 /bin/bash -c \"couchbase-cli server-add --cluster 10.42.0.11 --username admin --password exadsexads --services data,data,data --server-add 10.42.0.1${i} --server-add-username admin --server-add-password exadsexads\"\ndone\n\n# Rebalance\ndocker exec -it couchbase1 /bin/bash -c \"couchbase-cli rebalance --cluster=10.42.0.11 --username=admin --password=exadsexads\""
description: cluster couchbase
arguments: []
tags: []
source_url: ~
author: ~
author_url: ~
shells: []
